param($ResourceGroupName)

$SettingsString = "{ ""AntimalwareEnabled"": true }"
$list = Get-AzVM -ResourceGroupName $ResourceGroupName
$list | ForEach-Object {
    Write-Host "Updating ${_.Name}"
    Set-AzVMExtension -ResourceGroupName $ResourceGroupName -Location $_.Location -VMName $_.Name -Name "IaaSAntimalware" -Publisher "Microsoft.Azure.Security" -Type "IaaSAntimalware" -TypeHandlerVersion "1.3" -SettingString $SettingsString
    Write-Host "Anitmalware enabled on ${_.Name}"
}
 

